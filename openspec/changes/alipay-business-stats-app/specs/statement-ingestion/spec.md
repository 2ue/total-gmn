## ADDED Requirements

### Requirement: 导入支付宝 CSV 并提取账单级账号信息
系统 SHALL 支持导入 GB18030 编码的支付宝原始 CSV，并同时解析导出头部信息与交易明细行。

#### Scenario: 从导出头部提取账单所属账号
- **WHEN** 用户导入标准支付宝账单 CSV
- **THEN** 系统必须从导出头部的 `支付宝账户` 字段提取账单账号
- **THEN** 系统必须把该账单账号写入该文件解析出的每一条交易记录

#### Scenario: 从正确表头开始解析交易明细
- **WHEN** 账单文件在明细表头前包含说明文本
- **THEN** 系统必须从 `交易时间,交易分类,交易对方` 这一行开始解析
- **THEN** 系统必须映射至少这些字段：`交易时间,商品说明,收/支,金额,交易状态,交易订单号,商家订单号,备注`

### Requirement: 导入简化 CSV（金額、备注）
系统 SHALL 支持导入至少包含 `金额,备注` 两列的简化 CSV，并标准化为统一交易模型。

#### Scenario: 正金额映射为收入
- **WHEN** 导入行金额为正数
- **THEN** 系统必须将 `收/支` 归类为 `收入`
- **THEN** 在未提供状态时，系统必须默认交易状态为 `交易成功`

#### Scenario: 负金额映射为支出
- **WHEN** 导入行金额为负数
- **THEN** 系统必须将 `收/支` 归类为 `支出`
- **THEN** 系统必须以两位小数的绝对值写入标准化金额字段

#### Scenario: 零金额处理一致
- **WHEN** 导入行金额为 0
- **THEN** 系统必须允许该记录入库以便审计
- **THEN** 系统必须在净收益计算时将该记录视为 0 贡献

#### Scenario: 用备注回填商品说明
- **WHEN** 导入行缺少 `商品说明`
- **THEN** 系统必须使用 `备注` 作为标准化描述字段，用于后续规则分类

### Requirement: 统一交易模型并入库存档
系统 SHALL 把所有来源记录标准化后入库，后续统计只能基于数据库数据生成。

#### Scenario: 生成标准化交易记录
- **WHEN** 任意来源行被导入接受
- **THEN** 系统必须生成至少包含 `sourceType,billAccount,transactionTime,direction,amount,status,description,orderId,merchantOrderId,remark` 的标准化记录
- **THEN** 系统必须以 decimal(18,2) 兼容精度保存金额
- **THEN** 系统必须保存原始行 payload 以便审计和问题排查

### Requirement: 阶段1仅入库符合条件交易
系统 SHALL 在阶段1只将符合业务条件的交易写入业务交易表。

#### Scenario: 过滤后再入库
- **WHEN** 导入批次解析出标准化交易集合
- **THEN** 系统必须先应用已确认筛选规则（时间窗口、主营关键词、排除词、闲鱼转账、成本分类）
- **THEN** 系统必须仅将符合条件记录写入 `QualifiedTransaction`

#### Scenario: 非符合条件记录不进入业务交易表
- **WHEN** 某条交易未命中任何符合条件规则
- **THEN** 系统必须不将该记录写入 `QualifiedTransaction`
- **THEN** 系统必须保留该行原始信息于导入批次上下文（用于后续排查）
